import{a as Z}from"./chunk-HDBGLD52.js";import{a as Q}from"./chunk-HKBOYPO3.js";import{b as X,c as re,d as ne}from"./chunk-BM7DUPOK.js";import"./chunk-R7WH3GYF.js";import"./chunk-JCJIXIGU.js";import{a as K}from"./chunk-HE5QXQ2G.js";import{e as k}from"./chunk-UFL4XQUW.js";import"./chunk-OJYR24EB.js";import"./chunk-A3A72ILT.js";import{a as J}from"./chunk-TVMSW2JO.js";import"./chunk-CUKNIT7M.js";import{a as q}from"./chunk-AY56TXUB.js";import{v as Y}from"./chunk-VMH4ILIM.js";import"./chunk-6AWQUBPH.js";import"./chunk-HZKDOO2A.js";import"./chunk-JLIX64RS.js";import{c as O}from"./chunk-VORQTW3B.js";import"./chunk-FVBRAVME.js";import"./chunk-L2D7AHNW.js";import"./chunk-POHCU53O.js";import{a as G}from"./chunk-6QI4QBU5.js";import"./chunk-DXFFT4B6.js";import"./chunk-UJ255QIO.js";import"./chunk-MXV4M2BO.js";import"./chunk-4N6BO7AP.js";import"./chunk-RU375CWH.js";import"./chunk-KXJUWRJT.js";import{a as W}from"./chunk-SB5MWYDA.js";import{a as z}from"./chunk-EMZRNCIP.js";import{a as U,c as M}from"./chunk-DKHW3YWA.js";import{r as N,t as H}from"./chunk-2T5SWUVG.js";import{B as m,Cb as h,Db as f,Eb as B,Ib as S,J as I,Nb as v,Pb as d,T as l,Wa as g,Xa as C,Z as E,ca as y,f as j,g as F,gc as D,ha as $,mb as x,mc as V,nc as P,p as c,qa as p,ra as u,rb as _,xb as R,zc as A}from"./chunk-NSU275EB.js";import{a as L,b as T,g as ie}from"./chunk-ODN5LVDJ.js";re();var Ie=ie(ne());var ee=(()=>{class r{http;cookieService;baseUrl=z.apiUrl;constructor(e,o){this.http=e,this.cookieService=o}getHeaders(){let e=this.cookieService.get("token");return new U({Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"})}getRooms(){return this.http.get(`${this.baseUrl}/rooms`,{headers:this.getHeaders()}).pipe(c(e=>e.data))}addRoom(e){return this.http.post(`${this.baseUrl}/addRoom`,e,{headers:this.getHeaders()}).pipe(c(o=>o.data))}updateRoom(e,o){return this.http.put(`${this.baseUrl}/rooms/${e}`,o,{headers:this.getHeaders()}).pipe(c(t=>t.data))}deleteRoom(e){return this.http.delete(`${this.baseUrl}/rooms/${e}`,{headers:this.getHeaders()})}static \u0275fac=function(o){return new(o||r)(y(M),y(W))};static \u0275prov=E({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function le(r,b){r&1&&(h(0,"div",1),B(1,"app-loading"),f())}function de(r,b){if(r&1){let e=S();h(0,"app-table-generic",6),v("edit",function(t){p(e);let i=d(2);return u(i.openEditRoomDialog(t))})("delete",function(t){p(e);let i=d(2);return u(i.deleteRoom(t))}),f()}if(r&2){let e=d(2);_("columns",e.columns)("data",b)("tableName","room/s")("displayedColumns",e.displayedColumns)}}function ce(r,b){if(r&1){let e=S();h(0,"div",2)(1,"app-table-header",3),v("inputChange",function(t){p(e);let i=d();return u(i.onInputChange(t))})("add",function(){p(e);let t=d();return u(t.openAddRoomDialog())})("export",function(){p(e);let t=d();return u(t.onExport())}),f()(),h(2,"div",4),x(3,de,1,4,"app-table-generic",5),V(4,"async"),f()}if(r&2){let e,o=d();_("@fadeAnimation",void 0),g(),_("inputFields",o.headerInputFields)("addButtonLabel","Add Room"),g(),_("@fadeAnimation",void 0),g(),R((e=P(4,5,o.rooms$))?3:-1,e)}}var Ee=(()=>{class r{cdr;dialog;snackBar;roomService;roomTypes=["Lecture","Laboratory","Office"];floors=["1st","2nd","3rd","4th","5th"];selectedRoomIndex=null;roomsSubject=new F([]);rooms$=this.roomsSubject.asObservable();columns=[{key:"index",label:"#"},{key:"room_code",label:"Room Code"},{key:"location",label:"Location"},{key:"floor_level",label:"Floor Level"},{key:"room_type",label:"Room Type"},{key:"capacity",label:"Capacity"},{key:"status",label:"Status"}];displayedColumns=["index","room_code","location","floor_level","room_type","capacity","status"];headerInputFields=[{type:"text",label:"Search Rooms",key:"search"}];isLoading=!0;destroy$=new j;constructor(e,o,t,i){this.cdr=e,this.dialog=o,this.snackBar=t,this.roomService=i}ngOnInit(){this.fetchRooms()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}fetchRooms(){this.isLoading=!0,this.roomService.getRooms().pipe(m(e=>(this.snackBar.open("Error fetching rooms data","Close",{duration:3e3}),[])),I(()=>{this.isLoading=!1,this.cdr.markForCheck()}),l(this.destroy$)).subscribe(e=>{this.roomsSubject.next(e)})}onInputChange(e){e.search!==void 0&&this.onSearch(e.search)}onSearch(e){this.roomService.getRooms().pipe(c(o=>o.filter(t=>t.room_code.toLowerCase().includes(e.toLowerCase())||t.location.toLowerCase().includes(e.toLowerCase()))),m(()=>(this.snackBar.open("Error during search","Close",{duration:3e3}),[])),l(this.destroy$)).subscribe(o=>{this.roomsSubject.next(o),this.cdr.markForCheck()})}getDialogConfig(e){return{title:e?"Edit Room":"Add Room",isEdit:!!e,fields:[{label:"Room Code",formControlName:"room_code",type:"text",maxLength:15,required:!0},{label:"Location",formControlName:"location",type:"text",maxLength:25,required:!0},{label:"Floor Level",formControlName:"floor_level",type:"select",options:this.floors,required:!0},{label:"Room Type",formControlName:"room_type",type:"select",options:this.roomTypes,required:!0},{label:"Capacity",formControlName:"capacity",type:"number",min:1,max:999,required:!0},{label:"Status",formControlName:"status",type:"select",options:["Available","Unavailable"],required:!0}],initialValue:e||{}}}openAddRoomDialog(){let e=this.getDialogConfig();this.dialog.open(k,{data:e,disableClose:!0}).afterClosed().pipe(l(this.destroy$)).subscribe(t=>{t&&this.roomService.addRoom(t).pipe(m(()=>(this.snackBar.open("Error adding room","Close",{duration:3e3}),[])),l(this.destroy$)).subscribe(i=>{let a=this.roomsSubject.getValue();this.roomsSubject.next([...a,i]),this.snackBar.open(`Room ${i.room_code} added successfully.`,"Close",{duration:3e3})})})}openEditRoomDialog(e){let o=this.getDialogConfig(e);this.dialog.open(k,{data:o,disableClose:!0}).afterClosed().pipe(l(this.destroy$)).subscribe(i=>{if(i){let a=T(L({},i),{room_id:e.room_id});this.updateRoom(a)}})}updateRoom(e){let o=e.room_id;o!==void 0&&this.roomService.updateRoom(o,e).pipe(m(()=>(this.snackBar.open("Error updating room.","Close",{duration:3e3}),[])),l(this.destroy$)).subscribe(t=>{let i=this.roomsSubject.getValue(),a=i.findIndex(n=>n.room_id===o);a!==-1&&(i[a]=t,this.roomsSubject.next([...i]),this.snackBar.open(`Room ${t.room_code} updated successfully.`,"Close",{duration:3e3}))})}deleteRoom(e){let o=e.room_id;o!==void 0&&this.roomService.deleteRoom(o).pipe(m(t=>{let i=t.error?.message||"Error deleting room.";return this.snackBar.open(i,"Close",{duration:3e3}),[]}),l(this.destroy$)).subscribe(t=>{if(t.success){let i=this.roomsSubject.getValue().filter(a=>a.room_id!==o);this.roomsSubject.next(i),this.snackBar.open(`Room ${e.room_code} deleted successfully.`,"Close",{duration:3e3})}})}createPdfBlob(){let e=new X("p","mm","legal"),o=e.internal.pageSize.width,t=10,i=22,n=15;try{e.addImage("https://iantuquib.weebly.com/uploads/5/9/7/7/59776029/2881282_orig.png","PNG",t,10,i,i),e.setFontSize(12),e.setFont("times","bold"),e.text("POLYTECHNIC UNIVERSITY OF THE PHILIPPINES \u2013 TAGUIG BRANCH",o/2,n,{align:"center"}),n+=5,e.setFontSize(12),e.text("Gen. Santos Ave. Upper Bicutan, Taguig City",o/2,n,{align:"center"}),n+=10,e.setFontSize(15),e.setTextColor(0,0,0),e.text("Room Report",o/2,n,{align:"center"}),n+=8,e.setDrawColor(0,0,0),e.setLineWidth(.5),e.line(t,n,o-t,n),n+=7;let oe=this.roomsSubject.getValue().map((s,te)=>[(te+1).toString(),s.room_code,s.location,s.floor_level,s.room_type,s.capacity.toString(),s.status]);return e.autoTable({startY:n,head:[["#","Room Code","Location","Floor Level","Room Type","Capacity","Status"]],body:oe,theme:"grid",headStyles:{fillColor:[128,0,0],textColor:[255,255,255],fontSize:9},bodyStyles:{fontSize:8,textColor:[0,0,0]},styles:{lineWidth:.1,overflow:"linebreak",cellPadding:2},columnStyles:{0:{cellWidth:15},1:{cellWidth:30},2:{cellWidth:40},3:{cellWidth:30},4:{cellWidth:40},5:{cellWidth:20},6:{cellWidth:25}},margin:{left:t,right:t},didDrawPage:s=>{n=s.cursor.y+10}}),e.output("blob")}catch(w){throw this.snackBar.open("Failed to generate PDF.","Close",{duration:3e3}),w}}onExport(){this.dialog.open(Q,{maxWidth:"70rem",width:"100%",data:{exportType:"all",entity:"Rooms",customTitle:"Export All Rooms",generatePdfFunction:e=>this.createPdfBlob(),generateFileNameFunction:()=>"pup_taguig_rooms_report.pdf"}})}static \u0275fac=function(o){return new(o||r)(C(A),C(O),C(J),C(ee))};static \u0275cmp=$({type:r,selectors:[["app-rooms"]],standalone:!0,features:[D],decls:3,vars:1,consts:[[1,"rooms-container"],[1,"loading-wrapper"],[1,"rooms-header-container"],[3,"inputChange","add","export","inputFields","addButtonLabel"],[1,"rooms-table-container"],[3,"columns","data","tableName","displayedColumns"],[3,"edit","delete","columns","data","tableName","displayedColumns"]],template:function(o,t){o&1&&(h(0,"div",0),x(1,le,2,0,"div",1)(2,ce,5,7),f()),o&2&&(g(),R(t.isLoading?1:2))},dependencies:[H,N,Y,Z,K,q],styles:[".rooms-container[_ngcontent-%COMP%]{transition:background-color .3s ease;display:flex;flex-direction:column;gap:var(--spacing-xs);height:100%}.rooms-table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:none;justify-content:none;gap:0;-ms-overflow-style:none;scrollbar-width:none;flex:1;overflow:auto;position:relative;border-radius:var(--border-radius-md)}.rooms-table-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"],data:{animation:[G]},changeDetection:0})}return r})();export{Ee as RoomsComponent};
