import{a as _e}from"./chunk-Z7LNNC7D.js";import{b as ce}from"./chunk-PRIEC27T.js";import"./chunk-NME5OWLW.js";import{a as b,b as de}from"./chunk-R7WH3GYF.js";import{a as pe}from"./chunk-PAWPQVJP.js";import{f as me}from"./chunk-2PMUV4MH.js";import{a as G,b as U,c as W,d as J,e as K,f as X,g as Z,h as ee,i as te,j as ie,k as ne,l as oe,m as ae}from"./chunk-OJYR24EB.js";import"./chunk-A3A72ILT.js";import{a as se}from"./chunk-TVMSW2JO.js";import"./chunk-CUKNIT7M.js";import{a as j}from"./chunk-OGNLWBT2.js";import{a as z}from"./chunk-AY56TXUB.js";import"./chunk-VMH4ILIM.js";import{a as re,b as le}from"./chunk-6AWQUBPH.js";import{b as F}from"./chunk-JLIX64RS.js";import{c as N}from"./chunk-VORQTW3B.js";import"./chunk-FVBRAVME.js";import{a as q,c as O}from"./chunk-L2D7AHNW.js";import"./chunk-POHCU53O.js";import{a as Q}from"./chunk-6QI4QBU5.js";import"./chunk-DXFFT4B6.js";import{a as H}from"./chunk-UJ255QIO.js";import"./chunk-MXV4M2BO.js";import"./chunk-4N6BO7AP.js";import"./chunk-RU375CWH.js";import"./chunk-KXJUWRJT.js";import"./chunk-SB5MWYDA.js";import"./chunk-EMZRNCIP.js";import"./chunk-DKHW3YWA.js";import{t as B}from"./chunk-2T5SWUVG.js";import{$b as R,Cb as o,Db as a,Eb as w,Fb as S,Gb as v,Ib as D,Nb as y,Pb as p,Tb as A,Ub as V,Vb as k,Wa as d,Xa as E,Zb as s,_b as I,gc as $,ha as M,hc as Y,mb as g,qa as C,qb as L,ra as h,rb as x,xb as T}from"./chunk-NSU275EB.js";import"./chunk-ODN5LVDJ.js";var ue=()=>[5,10,25,50,100];function fe(t,l){t&1&&(o(0,"div",1),w(1,"app-loading"),a())}function ge(t,l){t&1&&(o(0,"th",21),s(1," # "),a())}function Ce(t,l){if(t&1&&(o(0,"td",22)(1,"span"),s(2),a()()),t&2){let e=l.index,n=p(2);d(2),I(n.getRowIndex(e))}}function he(t,l){t&1&&(o(0,"th",23),s(1," Program Code "),a())}function xe(t,l){if(t&1&&(o(0,"td",24),s(1),a()),t&2){let e=l.$implicit;d(),R(" ",e.program_code," ")}}function Se(t,l){t&1&&(o(0,"th",23),s(1," Program Name "),a())}function ve(t,l){if(t&1&&(o(0,"td",24),s(1),a()),t&2){let e=l.$implicit;d(),R(" ",e.program_title," ")}}function ye(t,l){t&1&&(o(0,"th",23),s(1," Year Levels "),a())}function we(t,l){if(t&1){let e=D();o(0,"td",24)(1,"button",25),y("click",function(){let i=C(e).$implicit,r=p(2);return h(r.onOpenDialog(i,"yearLevel"))}),o(2,"mat-icon"),s(3,"school"),a(),s(4),a()()}if(t&2){let e=l.$implicit;d(4),R(" ",e.year_levels_selected==="All"?"All Year Levels":"Year Level "+e.year_levels_selected," ")}}function De(t,l){t&1&&(o(0,"th",23),s(1," Sections "),a())}function Re(t,l){if(t&1){let e=D();o(0,"td",24)(1,"button",25),y("click",function(){let i=C(e).$implicit,r=p(2);return h(r.onOpenDialog(i,"section"))}),o(2,"mat-icon"),s(3,"view_list"),a(),s(4),a()()}if(t&2){let e=l.$implicit;d(4),R(" ",e.section_selected==="All"?"All Sections":"Section "+e.section_selected," ")}}function Ee(t,l){t&1&&(o(0,"th",23),s(1," Action "),a())}function be(t,l){if(t&1){let e=D();o(0,"td",24)(1,"button",26),y("click",function(){let i=C(e).$implicit,r=p(2);return h(r.onView(i))}),o(2,"mat-icon"),s(3,"visibility"),a(),o(4,"span"),s(5,"View Schedule"),a()(),o(6,"button",27),y("click",function(){let i=C(e).$implicit,r=p(2);return h(r.onExportSingle(i))}),o(7,"mat-icon"),s(8,"print"),a(),o(9,"span"),s(10,"Export"),a()()()}}function Pe(t,l){t&1&&w(0,"tr",28)}function Me(t,l){t&1&&w(0,"tr",29)}function Le(t,l){if(t&1&&(o(0,"tr")(1,"td",30)(2,"div",31)(3,"div",32),w(4,"span",33),o(5,"span"),s(6," No programs found."),a()()()()()),t&2){let e=p(2);d(),L("colspan",e.displayedColumns.length)}}function Te(t,l){if(t&1){let e=D();o(0,"div",2)(1,"app-table-header",3),y("export",function(){C(e);let i=p();return h(i.onExportAll())})("inputChange",function(i){C(e);let r=p();return h(r.onInputChange(i))}),a()(),o(2,"div",4)(3,"div",5)(4,"table",6),S(5,7),g(6,ge,2,0,"th",8)(7,Ce,3,1,"td",9),v(),S(8,10),g(9,he,2,0,"th",11)(10,xe,2,1,"td",12),v(),S(11,13),g(12,Se,2,0,"th",11)(13,ve,2,1,"td",12),v(),S(14,14),g(15,ye,2,0,"th",11)(16,we,5,1,"td",12),v(),S(17,15),g(18,De,2,0,"th",11)(19,Re,5,1,"td",12),v(),S(20,16),g(21,Ee,2,0,"th",11)(22,be,11,0,"td",12),v(),g(23,Pe,1,0,"tr",17)(24,Me,1,0,"tr",18)(25,Le,7,1,"tr",19),a(),o(26,"mat-paginator",20),y("page",function(){C(e);let i=p();return h(i.updateDisplayedData())}),a()()()}if(t&2){let e=p();x("@fadeAnimation",void 0),d(),x("inputFields",e.inputFields)("showExportButton",!0)("showAddButton",!1),d(),x("@fadeAnimation",void 0),d(2),x("dataSource",e.dataSource),d(19),x("matHeaderRowDef",e.displayedColumns),d(),x("matRowDefColumns",e.displayedColumns),d(2),x("length",e.filteredData.length)("pageSize",10)("pageSizeOptions",Y(12,ue))("showFirstLastButtons",!0)}}var Ze=(()=>{class t{reportsService;dialog;snackBar;inputFields=[{type:"text",label:"Search Programs",key:"search"}];displayedColumns=["index","programCode","programName","yearLevel","section","action"];dataSource=new ae;filteredData=[];academicYear="";semester="";isLoading=!0;paginator;constructor(e,n,i){this.reportsService=e,this.dialog=n,this.snackBar=i}ngOnInit(){this.fetchProgramsData()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}fetchProgramsData(){this.isLoading=!0,this.reportsService.getProgramSchedulesReport().subscribe({next:e=>{let n=e.programs_schedule_reports.programs.map(i=>({program_id:i.program_id,program_code:i.program_code,program_title:i.program_title,year_levels:i.year_levels.map(r=>({year_level:r.year_level,sections:r.sections.map(m=>({section_name:m.section_name,schedules:m.schedules}))})),year_levels_selected:"All",section_selected:"All"}));this.academicYear=`${e.programs_schedule_reports.year_start}-${e.programs_schedule_reports.year_end}`,this.semester=this.getSemesterDisplay(e.programs_schedule_reports.semester),this.isLoading=!1,this.dataSource.data=n,this.filteredData=[...n],this.dataSource.paginator=this.paginator},error:e=>{this.isLoading=!1,console.error("Error fetching programs data:",e),this.snackBar.open("Failed to load programs data. Please try again later.","Close",{duration:5e3})}})}getSemesterDisplay(e){switch(e){case 1:return"1st Semester";case 2:return"2nd Semester";case 3:return"Summer Semester";default:return"Unknown Semester"}}getRowIndex(e){return this.paginator?e+1+this.paginator.pageIndex*this.paginator.pageSize:e+1}onInputChange(e){let n=e.search?e.search.trim().toLowerCase():"";n===""?this.dataSource.data=this.filteredData:this.dataSource.data=this.filteredData.filter(i=>i.program_code.toLowerCase().includes(n)||i.program_title.toLowerCase().includes(n))}onExportAll(){console.log("Export All clicked")}onOpenDialog(e,n){let i=[],r="",m=[];if(n==="yearLevel")m=["All",...e.year_levels.map(u=>u.year_level).map(String)],i=[{label:"Year Level",formControlName:"yearLevel",type:"select",options:m,required:!0}],r="Select Year Level";else if(n==="section"){if(e.year_levels_selected==="All")m=["All",...Array.from(new Set(e.year_levels.flatMap(u=>u.sections.map(P=>P.section_name))))];else{let c=e.year_levels.find(u=>u.year_level.toString()===e.year_levels_selected);c?m=["All",...c.sections.map(P=>P.section_name)]:m=["All"]}i=[{label:"Section",formControlName:"section",type:"select",options:m,required:!0}],r="Select Section"}let f={title:r,fields:i,isEdit:!1,initialValue:{[n==="yearLevel"?"yearLevel":"section"]:n==="yearLevel"?e.year_levels_selected:e.section_selected}};this.dialog.open(me,{data:f}).afterClosed().subscribe(c=>{c&&(n==="yearLevel"?(e.year_levels_selected=c.yearLevel,e.section_selected="All"):n==="section"&&(e.section_selected=c.section))})}onView(e){let n=e.year_levels_selected,i=e.section_selected,r=[];if(n==="All")e.year_levels.forEach(m=>{let f=m.year_level,_=[];if(i==="All")_=m.sections;else{let c=m.sections.find(u=>u.section_name===i);c&&(_=[c])}_.forEach(c=>{let u=`Year Level ${f} - Section ${c.section_name}`;r.push({title:u,scheduleData:c.schedules})})});else{let m=e.year_levels.find(f=>f.year_level.toString()===n);if(m){let f=[];if(i==="All")f=m.sections;else{let _=m.sections.find(c=>c.section_name===i);_&&(f=[_])}f.forEach(_=>{let c=`Year Level ${m.year_level} - Section ${_.section_name}`;r.push({title:c,scheduleData:_.schedules})})}}this.dialog.open(_e,{maxWidth:"90vw",width:"100%",data:{entity:"program",scheduleGroups:r,customTitle:`${e.program_title} (${e.program_code})`,academicYear:this.academicYear,semester:this.semester},disableClose:!0})}onExportSingle(e){console.log("Export Single clicked for:",e)}updateDisplayedData(){console.log("Page changed")}static \u0275fac=function(n){return new(n||t)(E(j),E(N),E(se))};static \u0275cmp=M({type:t,selectors:[["app-report-programs"]],viewQuery:function(n,i){if(n&1&&A(b,5),n&2){let r;V(r=k())&&(i.paginator=r.first)}},standalone:!0,features:[$],decls:3,vars:1,consts:[[1,"report-container"],[1,"loading-wrapper"],[1,"report-header-container"],[3,"export","inputChange","inputFields","showExportButton","showAddButton"],[1,"report-table-container"],[1,"table-container"],["mat-table","",1,"custom-table",3,"dataSource"],["matColumnDef","index"],["mat-header-cell","","class","custom-header index",4,"matHeaderCellDef"],["mat-cell","","class","index",4,"matCellDef"],["matColumnDef","programCode"],["mat-header-cell","","class","custom-header",4,"matHeaderCellDef"],["mat-cell","","class","custom-cell",4,"matCellDef"],["matColumnDef","programName"],["matColumnDef","yearLevel"],["matColumnDef","section"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[4,"matNoDataRow"],["aria-label","Select page",1,"custom-paginator",3,"page","length","pageSize","pageSizeOptions","showFirstLastButtons"],["mat-header-cell","",1,"custom-header","index"],["mat-cell","",1,"index"],["mat-header-cell","",1,"custom-header"],["mat-cell","",1,"custom-cell"],["mat-button","",1,"prim-button",3,"click"],["mat-button","",1,"sec-ripple","view-button",3,"click"],["mat-button","",1,"sec-ripple","export-button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data-cell"],[1,"flex-cell"],[1,"no-data-text"],["mat-symbol","info"]],template:function(n,i){n&1&&(o(0,"div",0),g(1,fe,2,0,"div",1)(2,Te,27,13),a()),n&2&&(d(),T(i.isLoading?1:2))},dependencies:[B,oe,G,W,Z,J,U,ee,K,X,te,ie,ne,de,b,le,re,O,q,ce,F,pe,z,H],data:{animation:[Q]}})}return t})();export{Ze as ReportProgramsComponent};
