import{a as k}from"./chunk-H5Z54XFB.js";import"./chunk-NME5OWLW.js";import{b as N,c as Pe,d as Le}from"./chunk-BM7DUPOK.js";import{a as H,b as Te}from"./chunk-R7WH3GYF.js";import"./chunk-JCJIXIGU.js";import{a as ve}from"./chunk-M774G3SU.js";import"./chunk-UI373YL4.js";import{a as ce,b as de,c as pe,d as ue,e as _e,f as he,g as fe,h as Ce,i as xe,j as ge,k as Se,l as Re,m as we}from"./chunk-OJYR24EB.js";import"./chunk-Y7FYPZNW.js";import"./chunk-A3A72ILT.js";import"./chunk-CUKNIT7M.js";import{a as se}from"./chunk-OGNLWBT2.js";import{a as re}from"./chunk-AY56TXUB.js";import{a as be,b as ye}from"./chunk-6AWQUBPH.js";import{u as me}from"./chunk-VMH4ILIM.js";import{b as ee}from"./chunk-JLIX64RS.js";import{c as oe,g as ie}from"./chunk-VORQTW3B.js";import"./chunk-FVBRAVME.js";import{a as ne,c as ae}from"./chunk-L2D7AHNW.js";import"./chunk-POHCU53O.js";import{a as le}from"./chunk-6QI4QBU5.js";import"./chunk-DXFFT4B6.js";import{a as te}from"./chunk-UJ255QIO.js";import"./chunk-MXV4M2BO.js";import"./chunk-4N6BO7AP.js";import"./chunk-RU375CWH.js";import"./chunk-KXJUWRJT.js";import"./chunk-SB5MWYDA.js";import"./chunk-EMZRNCIP.js";import"./chunk-DKHW3YWA.js";import{t as Z}from"./chunk-2T5SWUVG.js";import{$b as D,Cb as a,Db as r,Eb as M,Fb as w,Gb as b,Ib as B,Nb as F,Pb as x,Tb as X,Ub as q,Vb as W,Wa as u,Xa as z,Zb as c,gc as J,ha as j,hc as K,mb as C,qa as T,qb as Q,ra as v,rb as S,xb as G}from"./chunk-NSU275EB.js";import{g as Fe}from"./chunk-ODN5LVDJ.js";Pe();var Ct=Fe(Le());var He=()=>[5,10,25,50,100];function Ie(i,l){i&1&&(a(0,"div",1),M(1,"app-loading"),r())}function Ae(i,l){i&1&&(a(0,"th",21),c(1," # "),r())}function Ve(i,l){if(i&1&&(a(0,"td",22)(1,"span"),c(2),r()()),i&2){let e=l.index,o=x(2);u(2),D(" ",o.getRowIndex(e)," ")}}function $e(i,l){i&1&&(a(0,"th",23),c(1," Room Code "),r())}function ze(i,l){if(i&1&&(a(0,"td",24),c(1),r()),i&2){let e=l.$implicit;u(),D(" ",e.roomCode," ")}}function Be(i,l){i&1&&(a(0,"th",23),c(1," Location "),r())}function Ne(i,l){if(i&1&&(a(0,"td",24),c(1),r()),i&2){let e=l.$implicit;u(),D(" ",e.location," ")}}function ke(i,l){i&1&&(a(0,"th",23),c(1,"Floor"),r())}function Ye(i,l){if(i&1&&(a(0,"td",24),c(1),r()),i&2){let e=l.$implicit;u(),D(" ",e.floorLevel," Floor ")}}function Ue(i,l){i&1&&(a(0,"th",23),c(1," Capacity "),r())}function Oe(i,l){if(i&1&&(a(0,"td",24),c(1),r()),i&2){let e=l.$implicit;u(),D(" ",e.capacity," ")}}function je(i,l){i&1&&(a(0,"th",23),c(1," Action "),r())}function Qe(i,l){if(i&1){let e=B();a(0,"td",24)(1,"button",25),F("click",function(){let t=T(e).$implicit,n=x(2);return v(n.onView(t))}),a(2,"mat-icon"),c(3,"visibility"),r(),a(4,"span"),c(5,"View Schedule"),r()(),a(6,"button",26),F("click",function(){let t=T(e).$implicit,n=x(2);return v(n.onExportSingle(t))}),a(7,"mat-icon"),c(8,"print"),r(),a(9,"span"),c(10,"Export"),r()()()}}function Ge(i,l){i&1&&M(0,"tr",27)}function Xe(i,l){i&1&&M(0,"tr",28)}function qe(i,l){if(i&1&&(a(0,"tr")(1,"td",29)(2,"div",30)(3,"div",31),M(4,"span",32),a(5,"span"),c(6," No rooms found."),r()()()()()),i&2){let e=x(2);u(),Q("colspan",e.displayedColumns.length)}}function We(i,l){if(i&1){let e=B();a(0,"div",2)(1,"app-table-header",3),F("export",function(){T(e);let t=x();return v(t.onExportAll())})("inputChange",function(t){T(e);let n=x();return v(n.onInputChange(t))}),r()(),a(2,"div",4)(3,"div",5)(4,"table",6),w(5,7),C(6,Ae,2,0,"th",8)(7,Ve,3,1,"td",9),b(),w(8,10),C(9,$e,2,0,"th",11)(10,ze,2,1,"td",12),b(),w(11,13),C(12,Be,2,0,"th",11)(13,Ne,2,1,"td",12),b(),w(14,14),C(15,ke,2,0,"th",11)(16,Ye,2,1,"td",12),b(),w(17,15),C(18,Ue,2,0,"th",11)(19,Oe,2,1,"td",12),b(),w(20,16),C(21,je,2,0,"th",11)(22,Qe,11,0,"td",12),b(),C(23,Ge,1,0,"tr",17)(24,Xe,1,0,"tr",18)(25,qe,7,1,"tr",19),r(),a(26,"mat-paginator",20),F("page",function(){T(e);let t=x();return v(t.updateDisplayedData())}),r()()()}if(i&2){let e=x();S("@fadeAnimation",void 0),u(),S("inputFields",e.inputFields)("showExportButton",!0)("showAddButton",!1),u(),S("@fadeAnimation",void 0),u(2),S("dataSource",e.dataSource),u(19),S("matHeaderRowDef",e.displayedColumns),u(),S("matRowDefColumns",e.displayedColumns),u(2),S("length",e.filteredData.length)("pageSize",10)("pageSizeOptions",K(12,He))("showFirstLastButtons",!0)}}var gt=(()=>{class i{reportsService;dialog;inputFields=[{type:"text",label:"Search Rooms",key:"search"}];displayedColumns=["index","roomCode","location","floor","capacity","action"];dataSource=new we;filteredData=[];isLoading=!0;paginator;constructor(e,o){this.reportsService=e,this.dialog=o}ngOnInit(){this.fetchRoomData()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}ngAfterViewChecked(){this.dataSource.paginator!==this.paginator&&(this.dataSource.paginator=this.paginator)}fetchRoomData(){this.isLoading=!0,this.reportsService.getRoomSchedulesReport().subscribe({next:e=>{let o=e.room_schedule_reports.rooms.map(t=>({roomId:t.room_id,roomCode:t.room_code,location:t.location,floorLevel:t.floor_level,capacity:t.capacity,schedules:t.schedules,academicYear:`${e.room_schedule_reports.year_start}-${e.room_schedule_reports.year_end}`,semester:this.getSemesterDisplay(e.room_schedule_reports.semester)}));this.isLoading=!1,this.dataSource.data=o,this.filteredData=[...o],this.dataSource.paginator=this.paginator},error:e=>{this.isLoading=!1,console.error("Error fetching room data:",e)}})}getSemesterDisplay(e){switch(e){case 1:return"1st Semester";case 2:return"2nd Semester";case 3:return"Summer Semester";default:return"Unknown Semester"}}getRowIndex(e){return this.paginator?e+1+this.paginator.pageIndex*this.paginator.pageSize:e+1}onInputChange(e){let o=e.search?e.search.trim().toLowerCase():"";o===""?this.dataSource.data=this.filteredData:this.dataSource.data=this.filteredData.filter(t=>t.roomCode.toLowerCase().includes(o)||t.location.toLowerCase().includes(o)||t.floorLevel.toLowerCase().includes(o))}onView(e){this.dialog.open(k,{maxWidth:"90vw",width:"100%",data:{exportType:"single",entity:"room",entityData:e.schedules,customTitle:`Room ${e.roomCode}`,academicYear:e.academicYear,semester:e.semester,generatePdfFunction:o=>this.createPdfBlob(e)},disableClose:!0})}onExportAll(){let e=o=>this.generateAllRoomsPdfBlob();this.dialog.open(k,{maxWidth:"90vw",width:"100%",data:{exportType:"all",entity:"room",entityData:this.filteredData,customTitle:"All Room Schedules",generatePdfFunction:e,showViewToggle:!1},disableClose:!0})}onExportSingle(e){let o=this.createPdfBlob(e),t=URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.download=`${e.roomCode.replace(/\s+/g,"_")}_schedule_report.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}updateDisplayedData(){console.log("Paginator updated")}generateAllRoomsPdfBlob(){let e=new N("landscape","mm","a4"),o=e.internal.pageSize.width,t=10,n=15,d=22;return this.filteredData.length===0?(console.error("No data available to export."),new Blob):(this.filteredData.forEach((p,m)=>{m>0&&e.addPage();let P=this.drawHeader(e,n,o,t,d,`Room ${p.roomCode} Schedule`,this.getAcademicYearSubtitle(p));this.drawScheduleTable(e,p.schedules??[],P,t,o)}),e.output("blob"))}createPdfBlob(e){let o=new N("landscape","mm","a4"),t=o.internal.pageSize.width,n=10,d=15,p=22;if(e.schedules&&e.schedules.length>0){let m=this.drawHeader(o,d,t,n,p,`Room ${e.roomCode}`,this.getAcademicYearSubtitle(e));this.drawScheduleTable(o,e.schedules,m,n,t)}return o.output("blob")}drawHeader(e,o,t,n,d,p,m){let P="https://iantuquib.weebly.com/uploads/5/9/7/7/59776029/2881282_orig.png",I=t/25+25;e.addImage(P,"PNG",I,o-5,d,d),e.setFontSize(12),e.setFont("helvetica","bold"),e.text("POLYTECHNIC UNIVERSITY OF THE PHILIPPINES \u2013 TAGUIG BRANCH",t/2,o,{align:"center"});let s=o+5;return e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Gen. Santos Ave. Upper Bicutan, Taguig City",t/2,s,{align:"center"}),s+=10,e.setFontSize(12),e.setFont("helvetica","bold"),e.text(p,t/2,s,{align:"center"}),s+=8,m&&(e.setFontSize(10),e.setFont("helvetica","normal"),e.text(m,t/2,s,{align:"center"}),s+=8),e.setDrawColor(0,0,0),e.setLineWidth(.5),e.line(n,s,t-n,s),s+=7,s}drawScheduleTable(e,o,t,n,d){let p=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],m=(d-n*2)/p.length,I=e.internal.pageSize.height-n,s=t,f=s,De=()=>(e.addPage(),s=this.drawHeader(e,15,d,n,22,e.getNumberOfPages()>1?"Room Schedule (Continued)":"Room Schedule",this.getAcademicYearSubtitle(o[0])),p.forEach((y,R)=>{let _=n+R*m;e.setFillColor(128,0,0),e.setTextColor(255,255,255),e.rect(_,s,m,10,"F"),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(y,_+m/2,s+7,{align:"center"})}),s+=12,s);p.forEach((y,R)=>{let _=n+R*m;e.setFillColor(128,0,0),e.setTextColor(255,255,255),e.rect(_,s,m,10,"F"),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(y,_+m/2,s+7,{align:"center"})}),s+=12,p.forEach((y,R)=>{let _=n+R*m,g=s,Y=o.filter(h=>h.day===y).sort((h,U)=>this.timeToMinutes(h.start_time)-this.timeToMinutes(U.start_time));Y.length>0&&Y.forEach(h=>{g+35>I&&(p.forEach((A,E)=>{let V=n+E*m;e.setDrawColor(200,200,200),e.setLineWidth(.5),e.line(V,t,V,f)}),e.line(d-n,t,d-n,f),g=De(),f=g);let Ee=this.formatTime(h.start_time),Me=this.formatTime(h.end_time),O=[h.course_details.course_code,h.course_details.course_title,`${h.section_name} - ${h.program_code}`,h.faculty_name,`${Ee} - ${Me}`];e.setFillColor(240,240,240),e.rect(_,g,m,35,"F");let L=g+5;O.forEach((A,E)=>{if(e.setTextColor(0),e.setFontSize(9),e.setFont((E<=1,"helvetica"),E<=1?"bold":"normal"),e.splitTextToSize(A,m-10).forEach($=>{e.text($,_+5,L),L+=5}),E===O.length-1){let $=e.getTextWidth(A);e.setDrawColor(0,0,0),e.setLineWidth(.2),e.line(_+5,L-4,_+5+$,L-4)}}),g+=40,g>f&&(f=g)})}),p.forEach((y,R)=>{let _=n+R*m;e.setDrawColor(200,200,200),e.setLineWidth(.5),e.line(_,t,_,f)}),e.line(d-n,t,d-n,f),e.line(n,f,d-n,f)}formatTime(e){let[o,t]=e.split(":").map(Number),n=o>=12?"PM":"AM";return`${o%12||12}:${t.toString().padStart(2,"0")} ${n}`}timeToMinutes(e){let[o,t]=e.split(":").map(Number);return o*60+t}getAcademicYearSubtitle(e){return`For Academic Year ${e.academicYear}, ${e.semester}`}static \u0275fac=function(o){return new(o||i)(z(se),z(oe))};static \u0275cmp=j({type:i,selectors:[["app-report-rooms"]],viewQuery:function(o,t){if(o&1&&X(H,5),o&2){let n;q(n=W())&&(t.paginator=n.first)}},standalone:!0,features:[J],decls:3,vars:1,consts:[[1,"report-container"],[1,"loading-wrapper"],[1,"report-header-container"],[3,"export","inputChange","inputFields","showExportButton","showAddButton"],[1,"report-table-container"],[1,"table-container"],["mat-table","",1,"custom-table",3,"dataSource"],["matColumnDef","index"],["mat-header-cell","","class","custom-header index",4,"matHeaderCellDef"],["mat-cell","","class","index",4,"matCellDef"],["matColumnDef","roomCode"],["mat-header-cell","","class","custom-header",4,"matHeaderCellDef"],["mat-cell","","class","custom-cell",4,"matCellDef"],["matColumnDef","location"],["matColumnDef","floor"],["matColumnDef","capacity"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[4,"matNoDataRow"],["aria-label","Select page",1,"custom-paginator",3,"page","length","pageSize","pageSizeOptions","showFirstLastButtons"],["mat-header-cell","",1,"custom-header","index"],["mat-cell","",1,"index"],["mat-header-cell","",1,"custom-header"],["mat-cell","",1,"custom-cell"],["mat-button","",1,"sec-ripple","view-button",3,"click"],["mat-button","",1,"sec-ripple","export-button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data-cell"],[1,"flex-cell"],[1,"no-data-text"],["mat-symbol","info"]],template:function(o,t){o&1&&(a(0,"div",0),C(1,Ie,2,0,"div",1)(2,We,27,13),r()),o&2&&(u(),G(t.isLoading?1:2))},dependencies:[Z,ve,re,Re,ce,pe,fe,ue,de,Ce,_e,he,xe,ge,Se,Te,H,ye,be,ae,ne,ee,me,ie,te],data:{animation:[le]}})}return i})();export{gt as ReportRoomsComponent};
